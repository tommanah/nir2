<!doctype HTML>
<html>
<head>
    <title>WebAR без маркеров</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        AFRAME.registerComponent('place-object', {
            init: function () {
                const el = this.el;

                // Создаем новый объект
                const box = document.createElement('a-box');
                box.setAttribute('material', 'color: red;');
                box.setAttribute('scale', '0.5 0.5 0.5');
                el.sceneEl.appendChild(box); // Добавляем куб в сцену

                // Обработчик события клика
                el.sceneEl.addEventListener('click', function (event) {
                    console.log("Клик зарегистрирован"); // Лог при клике

                    // Создаем raycaster и вектор для мыши
                    const raycaster = new THREE.Raycaster();
                    const mouse = new THREE.Vector2();

                    // Получаем координаты мыши
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

                    // Устанавливаем raycaster
                    raycaster.setFromCamera(mouse, el.sceneEl.camera);

                    // Проверяем пересечения с объектами в сцене
                    const intersects = raycaster.intersectObjects(el.sceneEl.children, true);
                    console.log("Пересечения:", intersects); // Лог для проверки пересечений

                    if (intersects.length > 0) {
                        // Устанавливаем позицию объекта на место клика
                        box.setAttribute('position', intersects[0].point);
                        console.log("Куб добавлен на позицию:", intersects[0].point); // Лог для проверки позиции
                    } else {
                        console.log("Нет пересечения"); // Лог, если пересечение не найдено
                    }
                });
            }
        });
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <a-scene embedded arjs='sourceType: webcam;'>
        <a-entity camera></a-entity>
        <a-entity place-object></a-entity> <!-- Добавляем компонент для размещения объекта -->
    </a-scene>
</body>
</html>